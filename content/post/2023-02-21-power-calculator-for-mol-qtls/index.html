---
title: Power calculator for  mol QTLs
author: Haky Im
date: '2023-02-21'
slug: power-calculator-for-mol-qtls
categories:
  - how to
tags: []
editor_options: 
  chunk_output_type: console
---



<div id="pors-power-calculation" class="section level2">
<h2>PORS power calculation</h2>
<p>The success of the prediction training depends mostly on whether the corresponding QTL study will be powered. Thus, we provide here the power to detect molecular QTLs for a range of sample sizes, effect sizes, and minor allele frequencies.</p>
</div>
<div id="function-r2-from-beta-assuming-variance-of-y-1" class="section level2">
<h2>function: R2 from beta assuming variance of y = 1</h2>
<p><span class="math display">\[y = \delta \cdot x + \epsilon\]</span></p>
<p><span class="math display">\[r^2 = \delta^2 \cdot \text{var}(x) = \delta^2 \cdot 2 \cdot \text{maf} \cdot (1-\text{maf})\]</span></p>
<pre class="r"><code>mafvec = c(0.05, 0.10, 0.30) 
effvec = c(0.40, 0.60, 0.80) 
nvec = c(200,350,500) 
nsnps = 1000

## install.packages(&quot;pwr&quot;)
if (!(&quot;pwr&quot; %in% installed.packages()[, 1])) {
  install.packages(&quot;pwr&quot;)
}</code></pre>
</div>
<div id="create-data-frame-with-all-combinations" class="section level2">
<h2>create data frame with all combinations</h2>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──
## ✔ ggplot2 3.3.6     ✔ purrr   0.3.4
## ✔ tibble  3.1.8     ✔ dplyr   1.0.9
## ✔ tidyr   1.2.0     ✔ stringr 1.4.0
## ✔ readr   2.1.2     ✔ forcats 0.5.1
## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(knitr)

alpha = 0.05/nsnps
mat = matrix(NA,length(mafvec)*length(effvec)*length(nvec),4)
colnames(mat) = c(&quot;maf&quot;,&quot;eff&quot;,&quot;nsam&quot;,&quot;power&quot;)
cont = 1
for(maf in mafvec)
{
  for(nn in nvec)
  {
    for(eff in effvec)
    {
      r2 = eff^2 * 2 * maf * (1-maf)
      rr = sqrt(r2)
      pp = pwr::pwr.r.test(n = nn, r= rr , sig.level = alpha)
      mat[cont,] = c(maf, eff, nn, pp$power)
      cont = cont + 1
    }
  }
}

mat %&gt;% data.frame() %&gt;% 
  pivot_wider(names_from = nsam, values_from = power) %&gt;% 
  mutate(across(3:ncol(.), ~sprintf(&quot;%.1f%%&quot;, . * 100))) %&gt;% 
  kable(format = &quot;markdown&quot;, align = c(&quot;l&quot;, &quot;l&quot;, &quot;c&quot;, &quot;c&quot;, &quot;c&quot;), 
        caption = &quot;Power by sample size&quot;) </code></pre>
<table>
<caption><span id="tab:unnamed-chunk-3">Table 1: </span>Power by sample size</caption>
<thead>
<tr class="header">
<th align="left">maf</th>
<th align="left">eff</th>
<th align="center">200</th>
<th align="center">350</th>
<th align="center">500</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">0.05</td>
<td align="left">0.4</td>
<td align="center">1.0%</td>
<td align="center">3.9%</td>
<td align="center">9.7%</td>
</tr>
<tr class="even">
<td align="left">0.05</td>
<td align="left">0.6</td>
<td align="center">7.4%</td>
<td align="center">28.1%</td>
<td align="center">54.4%</td>
</tr>
<tr class="odd">
<td align="left">0.05</td>
<td align="left">0.8</td>
<td align="center">29.6%</td>
<td align="center">73.5%</td>
<td align="center">94.0%</td>
</tr>
<tr class="even">
<td align="left">0.10</td>
<td align="left">0.4</td>
<td align="center">4.8%</td>
<td align="center">19.2%</td>
<td align="center">40.5%</td>
</tr>
<tr class="odd">
<td align="left">0.10</td>
<td align="left">0.6</td>
<td align="center">33.9%</td>
<td align="center">78.4%</td>
<td align="center">95.9%</td>
</tr>
<tr class="even">
<td align="left">0.10</td>
<td align="left">0.8</td>
<td align="center">81.4%</td>
<td align="center">99.4%</td>
<td align="center">100.0%</td>
</tr>
<tr class="odd">
<td align="left">0.30</td>
<td align="left">0.4</td>
<td align="center">36.5%</td>
<td align="center">81.1%</td>
<td align="center">96.8%</td>
</tr>
<tr class="even">
<td align="left">0.30</td>
<td align="left">0.6</td>
<td align="center">95.5%</td>
<td align="center">100.0%</td>
<td align="center">100.0%</td>
</tr>
<tr class="odd">
<td align="left">0.30</td>
<td align="left">0.8</td>
<td align="center">100.0%</td>
<td align="center">100.0%</td>
<td align="center">100.0%</td>
</tr>
</tbody>
</table>
</div>
